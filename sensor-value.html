<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../sensor-base/sensor-base.html">
<link rel="import" href="../leaf-scale/leaf-scale.html">

<dom-module id="sensor-value">
  <style>
			:host{
				display: flex;
				flex-direction: row;
				align-items: center;
				justify-content: space-between;
				font-size: 1.7em;
				overflow: hidden;
				width: 100%;
				height: 100%;
			}



			p#minilabel{
				margin: 0px;
				margin-bottom: 20px;
				font-size: 2em;
				color: white;
				text-shadow: 2px 2px #000;
			}

			div#minivalue{
				width: 150px;
				height: 110px;
				text-align: center;
				background-repeat: no-repeat;
				background-position: center;

				display: flex;
				justify-content: center;
				align-items: center;
				color: white;
				text-shadow: 1px 1px #000;
			}

			#icon{
				display: block;
				max-height: 100%;
				max-width: 35%;
			}

			#value{
				display: flex;
				flex-direction: column;
				color: white;
				text-shadow: 1px 1px #000;
				max-width: 65%;
				max-height: 100%;
				width: auto;
				height: auto;
			}

			#value h1{
				margin-top: 0px;
				margin-bottom: 0px;
				overflow: hidden;
			}

			#value p{
				margin: 5px;
				font-size: 2em;
				overflow: hidden;
			}

			#big{
				display: flex;
				flex-direction: column;
				align-items: center;
				/* justify-content: center; */
				height: 100%;
				width: 100%;
			}

			#sensor{
				display: flex;
				align-items: center;
				justify-content: center;
				height: 100%;
				width: 100%;
			}
			#lscale {
				border-top: 1px solid lightgray;
				/* padding-top: 20px; */
				/* margin-top: 20px; */
				/* padding-top: 3%; */
				margin-top: 2%;
				padding-top: 2%;
				width: 100%;
			}
		</style>
  <template>

	<template is="dom-if" if="{{mini}}">
	  <p id="minilabel">{{label}}</p>
	  <div id="minivalue" style$="{{_computeStyle(icon, name)}}">
		<p><span>{{value}}</span> <span>{{unit}}</span></p><p>
		</p>
	  </div>
	  <template is="dom-if" if="{{qualityScale}}">
		<leaf-scale id="scale" leafcount="{{leafCount}}" level="{{computeQuality(quality)}}">
		</leaf-scale>
	  </template>
	</template>

	<template is="dom-if" if="{{!mini}}">
	  <div id="big">
		<div id="sensor" style$="{{_compute_dim(width,qualityScale)}}">
		  <img id="icon" src$="{{_computeSrc(icon, name)}}">
		  <div id="value">
			<h1>{{label}}</h1>
			<p><span>{{value}}</span> <span>{{unit}}</span></p>
		  </div>
		</div>
		<template is="dom-if" if="{{qualityScale}}">
		  <div id="lscale">
			<leaf-scale id="scale" leafcount="{{leafCount}}" level="{{computeQuality(quality)}}" style$="{{_compute_dim(width,qualityScale)}}"></leaf-scale>
		  </div>
		</template>
	  </div>
	</template>

  </template>
</dom-module>
<script>
	Polymer({
		is: 'sensor-value',
		properties: {
			name: {
				value: "sensor-value",
				notify: true
			},
			icon: {
				value: null,
				notify: true
			},
			leafCount: {
				type: Number,
				value: 3,
				notify: true
			},
			mini: {
				type: Boolean,
				value: false,
				notify: true
			},
			qualityScale: {
				type: Boolean,
				value: false,
				notify: true
			},
			width: {
				type: String,
				value: "",
				notify: true
			},
			height: {
				type: String,
				value: "",
				notify: true
			}
		},
		behaviors:[DiyaBehaviors.SensorBase],
		ready: function () {
			var scale = Polymer.dom(this.shadowRoot).querySelector('leaf-scale');
			if (scale) {
				scale.setLevel(3);
			}
		},
		computeQuality: function (quality) {
			return Math.floor(quality * this.leafCount);
		},
		_computeStyle: function (icon, name) {
			if(!icon && !name)
				return null;
			return 'background-image: url(\'bower_components/sensor-value/icons/' + (icon ? icon : name) + '.png\')';
		},
		_computeSrc: function (icon, name) {
			if(!icon && !name)
				return null;
			return 'bower_components/sensor-value/icons/'+(icon ? icon : name)+'Big.png';
		},
		_compute_dim(width,qualityScale) {
			return (width? "width: "+width+"; " :"")+"height: "+(qualityScale? "45%;" : "90%;");
		}
	});
</script>
